<!DOCTYPE html>
<html>
    <head>
        <title>TechJobs</title>
        
        <%= stylesheet_link_tag    "application", :media => "all" %>
        <%= javascript_include_tag "application" %>
        <%= csrf_meta_tags %>

        <script type="text/javascript">
        
            function isAlphaNumeric(theChar) {
                if ((theChar < 48) || (theChar > 122) || 
                   ((theChar > 57) && (theChar < 65)) || 
                   ((theChar > 90) && (theChar < 97))   ) {
                    return false;
                } else {
                    return true;
                }
            }
            
            function newTag() {
                $("<div class=\"token\"><i>New Tag: </i></div>").appendTo("#taglist");
                var tag = $(".token").last();
                $(document).keypress(function(evt) {
                    var key = evt.which;
                    if(isAlphaNumeric(key)) {
                        tag.html(tag.html() + String.fromCharCode(key));
                    } else if(key == 13) {
                        $(document).unbind();
                        var newtagtext = tag.html().substring(16);
                        tag.html(newtagtext);
                        tag.append(" <span class=\"removetag\">x</span>");

                        var curTagList = $("#job_posting_tags").attr('value');
                        if(curTagList == "[]") {
                            $("#job_posting_tags").attr('value', taglistOrig[arrayIndex]);
                        } else {
                            $("#job_posting_tags").attr('value', curTagList + ";" + taglistOrig[arrayIndex]);
                        }

                        $("span.removetag").click(function() {
                            var parent = $(this).parent();
                            $(this).remove();
                            var tagtext = $.trim(parent.html());
                            parent.remove();
                            
                            var curtags = $("#job_posting_tags").attr('value');
                            var newtags = curtags.replace(tagtext, '').replace(";;", ";");
                            $("#job_posting_tags").attr('value', newtags);
                        });
                    }
                });
            }

            $(document).ready(function() {
                var i = 0;
                $(".jobtable > tbody > tr:odd").addClass("odd");
                $(".jobtable > tbody > tr:even").addClass("even");
                /*
                $(".jobtable > tbody > tr").each(function() {
                    if(i % 4 == 0 || i % 4 == 1) {
                        $(this).addClass("odd");
                    } else {
                        $(this).addClass("even");
                    }
                });
                */
                $(".help").mouseover(function(evt) {
                    $("<div id=\"help\"></div>").prependTo("body");
                    $("#help")
                        .html($(this).attr('alt'))
                        .css({'top': evt.pageY + 3, 'left': evt.pageX + 3});
                }).mouseout(function() {
                    $("#help").remove();
                });
                
                var taglistdiv = document.getElementById('globaltaglist');
                taglistdiv.innerHTML = taglistdiv.innerHTML.substr(0, taglistdiv.innerHTML.length - 1);
                var taglistOrig = taglistdiv.innerHTML.split(";");
                var taglist = taglistdiv.innerHTML.toLowerCase().split(";");

                $("#addtag").click(newTag);
                var curword = "";
                $("#job_posting_description")
                    .keypress(function(evt) {
                        var key = evt.which;
                        if(isAlphaNumeric(key)) {
                            curword = curword + String.fromCharCode(key).toLowerCase();
                        } else {
                            curword = "";
                        }
                                                
                        var arrayIndex = $.inArray(curword, taglist);
                        if(arrayIndex != -1) {
                            $("<div class=\"token\">" + taglistOrig[arrayIndex] + " <span class=\"removetag\">x</span></div>").appendTo("#taglist");
                            var curTagList = $("#job_posting_tags").attr('value');
                            if(curTagList == "[]") {
                                $("#job_posting_tags").attr('value', taglistOrig[arrayIndex]);
                            } else {
                                $("#job_posting_tags").attr('value', curTagList + ";" + taglistOrig[arrayIndex]);
                            }
                            $("span.removetag").click(function() {
                                var parent = $(this).parent();
                                $(this).remove();
                                var tagtext = $.trim(parent.html());
                                parent.remove();
                                
                                var curtags = $("#job_posting_tags").attr('value');
                                var newtags = curtags.replace(tagtext, '').replace(";;", ";");
                                $("#job_posting_tags").attr('value', newtags);
                            });
                        }
                    });
            });
        </script>
        
    </head>
    <body>
        <div id="wrap">
            <img src="http://www.cs.uchicago.edu/i/header_background.jpg">
            <div id="header">
                <div id="loginpanel">
                    <% if user_signed_in? %>
                    <%= link_to('Dashboard', dashboard_path, :class=>"loginpanel") %>        
                    <br/>
                    <%= link_to('Sign Out', destroy_user_session_path, :method => :delete, :class=>"loginpanel") %>        
                    <% else %>
                    <%= link_to('Sign In', new_user_session_path, :class=>"loginpanel")  %>  
                    <% end %>
                    <br/>
                    <% if user_signed_in? %>
                      <%= link_to('Edit Account', edit_user_registration_path, :class=>"loginpanel") %>
                    <% else %>
                      <%= link_to('Create Account', new_user_registration_path, :class=>"loginpanel")  %>
                    <% end %>
                </div>
                <h1><%= link_to('CS.UCHICAGO JOB POSTINGS', root_path) %></h1>
            </div>

	    <% flash.each do |key, value| -%>
	    <div class="notice"><%= value %></div>
	    <% end -%>

	    <%= yield %>

        </div>
    </body>
</html>
